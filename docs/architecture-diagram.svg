<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" style="background-color: #ffffff;">
  <defs>
    <!-- Excalidraw-style rough filter -->
    <filter id="rough" x="-5%" y="-5%" width="110%" height="110%">
      <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5" result="noise"/>
      <feDisplacementMap in="SourceGraphic" in2="noise" scale="1" xChannelSelector="R" yChannelSelector="G"/>
    </filter>

    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#495057"/>
    </marker>

    <!-- Fonts -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Virgil:wght@400&amp;display=swap');
      text { font-family: 'Segoe UI', system-ui, sans-serif; }
      .title { font-size: 24px; font-weight: bold; fill: #1e1e1e; }
      .subtitle { font-size: 14px; fill: #495057; }
      .label { font-size: 12px; fill: #1e1e1e; }
      .small { font-size: 10px; fill: #868e96; }
    </style>
  </defs>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" class="title">K3s Remotelab Cluster Architecture</text>
  <text x="600" y="60" text-anchor="middle" class="subtitle">mTLS via Linkerd | Path-based routing | GitOps CI/CD</text>

  <!-- External Users Box -->
  <rect x="500" y="80" width="200" height="50" rx="8" fill="#e9ecef" stroke="#495057" stroke-width="2"/>
  <text x="600" y="110" text-anchor="middle" class="label">External Users (Browser)</text>

  <!-- Arrow from users to ingress -->
  <line x1="600" y1="130" x2="600" y2="160" stroke="#495057" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="620" y="150" class="small">HTTPS</text>

  <!-- Ingress Layer -->
  <rect x="50" y="170" width="1100" height="80" rx="12" fill="#fff5f5" stroke="#fa5252" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="70" y="195" class="label" fill="#c92a2a">Ingress Layer</text>

  <!-- Traefik -->
  <rect x="450" y="190" width="300" height="50" rx="8" fill="#ffffff" stroke="#fa5252" stroke-width="2"/>
  <text x="600" y="215" text-anchor="middle" class="label">Traefik Ingress Controller</text>
  <text x="600" y="230" text-anchor="middle" class="small">TLS Termination | Path Routing | localhost/*</text>

  <!-- Service Mesh Layer -->
  <rect x="50" y="270" width="1100" height="60" rx="12" fill="#e7f5ff" stroke="#339af0" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="70" y="295" class="label" fill="#1864ab">Service Mesh</text>

  <!-- Linkerd -->
  <rect x="450" y="280" width="300" height="40" rx="8" fill="#ffffff" stroke="#339af0" stroke-width="2"/>
  <text x="600" y="305" text-anchor="middle" class="label">Linkerd (mTLS for all pod-to-pod traffic)</text>

  <!-- Main content area with namespaces -->

  <!-- Applications Namespace -->
  <rect x="50" y="350" width="700" height="320" rx="12" fill="#ebfbee" stroke="#40c057" stroke-width="2"/>
  <text x="70" y="375" class="label" fill="#2f9e44">namespace: applications</text>

  <!-- Django App -->
  <rect x="70" y="390" width="140" height="90" rx="8" fill="#ffffff" stroke="#40c057" stroke-width="2"/>
  <text x="140" y="420" text-anchor="middle" class="label">Django API</text>
  <text x="140" y="440" text-anchor="middle" class="small">REST API</text>
  <text x="140" y="455" text-anchor="middle" class="small">:8000</text>
  <text x="140" y="470" text-anchor="middle" class="small">/django/*</text>

  <!-- Redis -->
  <rect x="70" y="500" width="140" height="70" rx="8" fill="#ffffff" stroke="#fa5252" stroke-width="2"/>
  <text x="140" y="530" text-anchor="middle" class="label">Redis</text>
  <text x="140" y="550" text-anchor="middle" class="small">Cache :6379</text>

  <!-- Arrow Django to Redis -->
  <line x1="140" y1="480" x2="140" y2="500" stroke="#495057" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Gitea -->
  <rect x="240" y="390" width="160" height="90" rx="8" fill="#ffffff" stroke="#40c057" stroke-width="2"/>
  <text x="320" y="420" text-anchor="middle" class="label">Gitea</text>
  <text x="320" y="440" text-anchor="middle" class="small">Git + Registry</text>
  <text x="320" y="455" text-anchor="middle" class="small">:3000</text>
  <text x="320" y="470" text-anchor="middle" class="small">/gitea/* /v2/*</text>

  <!-- PostgreSQL -->
  <rect x="240" y="500" width="160" height="70" rx="8" fill="#ffffff" stroke="#339af0" stroke-width="2"/>
  <text x="320" y="530" text-anchor="middle" class="label">PostgreSQL</text>
  <text x="320" y="550" text-anchor="middle" class="small">Database :5432</text>

  <!-- Arrow Gitea to PostgreSQL -->
  <line x1="320" y1="480" x2="320" y2="500" stroke="#495057" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Act Runner -->
  <rect x="430" y="390" width="160" height="90" rx="8" fill="#ffffff" stroke="#fab005" stroke-width="2"/>
  <text x="510" y="420" text-anchor="middle" class="label">Actions Runner</text>
  <text x="510" y="440" text-anchor="middle" class="small">act-runner</text>
  <text x="510" y="455" text-anchor="middle" class="small">Docker-in-Docker</text>
  <text x="510" y="470" text-anchor="middle" class="small">CI/CD Jobs</text>

  <!-- Arrow Runner to Gitea -->
  <line x1="430" y1="435" x2="400" y2="435" stroke="#495057" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- GitOps Namespace -->
  <rect x="770" y="350" width="380" height="160" rx="12" fill="#f3f0ff" stroke="#7950f2" stroke-width="2"/>
  <text x="790" y="375" class="label" fill="#6741d9">namespace: argocd</text>

  <!-- ArgoCD -->
  <rect x="790" y="390" width="150" height="90" rx="8" fill="#ffffff" stroke="#7950f2" stroke-width="2"/>
  <text x="865" y="420" text-anchor="middle" class="label">ArgoCD</text>
  <text x="865" y="440" text-anchor="middle" class="small">GitOps CD</text>
  <text x="865" y="455" text-anchor="middle" class="small">:8080</text>
  <text x="865" y="470" text-anchor="middle" class="small">/argocd/*</text>

  <!-- ArgoCD Image Updater -->
  <rect x="960" y="390" width="170" height="90" rx="8" fill="#ffffff" stroke="#7950f2" stroke-width="2"/>
  <text x="1045" y="420" text-anchor="middle" class="label">Image Updater</text>
  <text x="1045" y="440" text-anchor="middle" class="small">Watches Registry</text>
  <text x="1045" y="455" text-anchor="middle" class="small">Auto-updates</text>
  <text x="1045" y="470" text-anchor="middle" class="small">Deployments</text>

  <!-- Arrow Image Updater to Gitea Registry -->
  <path d="M 960 470 Q 700 550 590 470" stroke="#495057" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)"/>
  <text x="750" y="530" class="small">watches registry</text>

  <!-- Monitoring Namespace -->
  <rect x="770" y="530" width="380" height="140" rx="12" fill="#fff9db" stroke="#fab005" stroke-width="2"/>
  <text x="790" y="555" class="label" fill="#e67700">namespace: monitoring</text>

  <!-- Prometheus -->
  <rect x="790" y="570" width="150" height="80" rx="8" fill="#ffffff" stroke="#fab005" stroke-width="2"/>
  <text x="865" y="600" text-anchor="middle" class="label">Prometheus</text>
  <text x="865" y="620" text-anchor="middle" class="small">Metrics :9090</text>
  <text x="865" y="635" text-anchor="middle" class="small">/prometheus/*</text>

  <!-- Grafana -->
  <rect x="960" y="570" width="170" height="80" rx="8" fill="#ffffff" stroke="#fab005" stroke-width="2"/>
  <text x="1045" y="600" text-anchor="middle" class="label">Grafana</text>
  <text x="1045" y="620" text-anchor="middle" class="small">Dashboards :3000</text>
  <text x="1045" y="635" text-anchor="middle" class="small">/grafana/*</text>

  <!-- Arrow Grafana to Prometheus -->
  <line x1="960" y1="610" x2="940" y2="610" stroke="#495057" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Prometheus scraping arrows -->
  <path d="M 790 610 Q 650 610 590 470" stroke="#fab005" stroke-width="1" fill="none" stroke-dasharray="4,4"/>
  <path d="M 790 630 Q 500 700 140 570" stroke="#fab005" stroke-width="1" fill="none" stroke-dasharray="4,4"/>
  <text x="500" y="640" class="small" fill="#e67700">scrapes metrics</text>

  <!-- Storage Layer -->
  <rect x="50" y="700" width="1100" height="70" rx="12" fill="#f8f9fa" stroke="#868e96" stroke-width="2"/>
  <text x="70" y="725" class="label" fill="#495057">Persistent Storage (local-path provisioner)</text>

  <rect x="80" y="735" width="80" height="25" rx="4" fill="#ffffff" stroke="#868e96" stroke-width="1"/>
  <text x="120" y="752" text-anchor="middle" class="small">Django 2Gi</text>

  <rect x="170" y="735" width="80" height="25" rx="4" fill="#ffffff" stroke="#868e96" stroke-width="1"/>
  <text x="210" y="752" text-anchor="middle" class="small">Gitea 10Gi</text>

  <rect x="260" y="735" width="90" height="25" rx="4" fill="#ffffff" stroke="#868e96" stroke-width="1"/>
  <text x="305" y="752" text-anchor="middle" class="small">Postgres 5Gi</text>

  <rect x="360" y="735" width="80" height="25" rx="4" fill="#ffffff" stroke="#868e96" stroke-width="1"/>
  <text x="400" y="752" text-anchor="middle" class="small">Redis 1Gi</text>

  <rect x="450" y="735" width="80" height="25" rx="4" fill="#ffffff" stroke="#868e96" stroke-width="1"/>
  <text x="490" y="752" text-anchor="middle" class="small">Runner 5Gi</text>

  <rect x="540" y="735" width="100" height="25" rx="4" fill="#ffffff" stroke="#868e96" stroke-width="1"/>
  <text x="590" y="752" text-anchor="middle" class="small">Prometheus 10Gi</text>

  <rect x="650" y="735" width="80" height="25" rx="4" fill="#ffffff" stroke="#868e96" stroke-width="1"/>
  <text x="690" y="752" text-anchor="middle" class="small">Grafana 1Gi</text>

  <!-- CI/CD Flow annotation -->
  <rect x="50" y="790" width="550" height="100" rx="8" fill="#f8f9fa" stroke="#495057" stroke-width="1"/>
  <text x="70" y="815" class="label">CI/CD Pipeline Flow:</text>
  <text x="70" y="835" class="small">1. Developer pushes to Gitea repository</text>
  <text x="70" y="850" class="small">2. Actions Runner builds &amp; pushes image to Gitea Registry</text>
  <text x="70" y="865" class="small">3. ArgoCD Image Updater detects new image, updates manifest</text>
  <text x="70" y="880" class="small">4. ArgoCD syncs deployment to cluster (rolling update)</text>

  <!-- Legend -->
  <rect x="620" y="790" width="530" height="100" rx="8" fill="#f8f9fa" stroke="#495057" stroke-width="1"/>
  <text x="640" y="815" class="label">Legend:</text>

  <rect x="640" y="825" width="20" height="12" rx="2" fill="#ebfbee" stroke="#40c057" stroke-width="1"/>
  <text x="670" y="835" class="small">Applications</text>

  <rect x="760" y="825" width="20" height="12" rx="2" fill="#f3f0ff" stroke="#7950f2" stroke-width="1"/>
  <text x="790" y="835" class="small">GitOps</text>

  <rect x="860" y="825" width="20" height="12" rx="2" fill="#fff9db" stroke="#fab005" stroke-width="1"/>
  <text x="890" y="835" class="small">Monitoring</text>

  <rect x="980" y="825" width="20" height="12" rx="2" fill="#e7f5ff" stroke="#339af0" stroke-width="1"/>
  <text x="1010" y="835" class="small">Service Mesh</text>

  <line x1="640" y1="860" x2="680" y2="860" stroke="#495057" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="690" y="863" class="small">Data/API flow</text>

  <line x1="800" y1="860" x2="840" y2="860" stroke="#fab005" stroke-width="1" stroke-dasharray="4,4"/>
  <text x="850" y="863" class="small">Metrics scraping</text>

  <text x="640" y="882" class="small">All pod-to-pod traffic encrypted via Linkerd mTLS</text>
</svg>
