<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1100" style="background-color: #ffffff;">
  <defs>
    <!-- Arrow markers -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#495057"/>
    </marker>

    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#40c057"/>
    </marker>

    <!-- Fonts -->
    <style>
      text { font-family: 'Segoe UI', system-ui, sans-serif; }
      .title { font-size: 24px; font-weight: bold; fill: #1e1e1e; }
      .subtitle { font-size: 14px; fill: #495057; }
      .label { font-size: 13px; fill: #1e1e1e; font-weight: 500; }
      .small { font-size: 11px; fill: #495057; }
      .tiny { font-size: 9px; fill: #868e96; }
      .stage-label { font-size: 10px; fill: #495057; font-weight: 600; }
    </style>
  </defs>

  <!-- Title -->
  <text x="500" y="35" text-anchor="middle" class="title">CI/CD Pipeline Flow</text>
  <text x="500" y="55" text-anchor="middle" class="subtitle">From Code Commit to Running Application</text>

  <!-- Developer -->
  <rect x="400" y="80" width="200" height="50" rx="8" fill="#e9ecef" stroke="#495057" stroke-width="2"/>
  <text x="500" y="105" text-anchor="middle" class="label">ğŸ‘¨â€ğŸ’» Developer</text>
  <text x="500" y="120" text-anchor="middle" class="small">git push origin main</text>

  <!-- Arrow to Gitea -->
  <line x1="500" y1="130" x2="500" y2="170" stroke="#495057" stroke-width="2.5" marker-end="url(#arrowhead)"/>
  <text x="520" y="155" class="small">push code</text>

  <!-- Gitea Repository -->
  <rect x="350" y="180" width="300" height="80" rx="8" fill="#ffffff" stroke="#40c057" stroke-width="2.5"/>
  <text x="500" y="210" text-anchor="middle" class="label">ğŸ“¦ Gitea Repository</text>
  <text x="500" y="230" text-anchor="middle" class="small">remotelab/django-app</text>
  <text x="500" y="245" text-anchor="middle" class="tiny">gitea:3000/remotelab/django-app.git</text>

  <!-- Arrow to Actions -->
  <line x1="500" y1="260" x2="500" y2="300" stroke="#495057" stroke-width="2.5" marker-end="url(#arrowhead)"/>
  <text x="530" y="285" class="small">triggers webhook</text>

  <!-- Gitea Actions Pipeline -->
  <rect x="50" y="310" width="900" height="180" rx="12" fill="#fff5f5" stroke="#fa5252" stroke-width="2.5"/>
  <text x="70" y="340" class="label" fill="#c92a2a">ğŸ”„ Gitea Actions Pipeline (Actions Runner + Docker-in-Docker)</text>

  <!-- Stage 1: Test -->
  <rect x="80" y="360" width="240" height="110" rx="8" fill="#ffffff" stroke="#fab005" stroke-width="2"/>
  <text x="200" y="385" text-anchor="middle" class="stage-label">STAGE 1: TEST</text>
  <text x="200" y="405" text-anchor="middle" class="small">â€¢ Python 3.11 setup</text>
  <text x="200" y="422" text-anchor="middle" class="small">â€¢ Install dependencies</text>
  <text x="200" y="439" text-anchor="middle" class="small">â€¢ Run unit tests</text>
  <text x="200" y="456" text-anchor="middle" class="small">â€¢ Code quality (flake8)</text>

  <!-- Arrow from Test to Build -->
  <line x1="320" y1="415" x2="360" y2="415" stroke="#40c057" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="340" y="405" class="tiny" fill="#40c057">âœ“ pass</text>

  <!-- Stage 2: Build & Push -->
  <rect x="370" y="360" width="240" height="110" rx="8" fill="#ffffff" stroke="#339af0" stroke-width="2"/>
  <text x="490" y="385" text-anchor="middle" class="stage-label">STAGE 2: BUILD &amp; PUSH</text>
  <text x="490" y="405" text-anchor="middle" class="small">â€¢ Build Docker image</text>
  <text x="490" y="422" text-anchor="middle" class="small">â€¢ Tag: gitea:3000/.../app:1.0.X</text>
  <text x="490" y="439" text-anchor="middle" class="small">â€¢ Push to Gitea Registry</text>
  <text x="490" y="456" text-anchor="middle" class="tiny">(skopeo copy with metadata)</text>

  <!-- Arrow from Build to Security -->
  <line x1="610" y1="415" x2="650" y2="415" stroke="#40c057" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  <text x="630" y="405" class="tiny" fill="#40c057">âœ“ pushed</text>

  <!-- Stage 3: Security Scan -->
  <rect x="660" y="360" width="240" height="110" rx="8" fill="#ffffff" stroke="#7950f2" stroke-width="2"/>
  <text x="780" y="385" text-anchor="middle" class="stage-label">STAGE 3: SECURITY</text>
  <text x="780" y="405" text-anchor="middle" class="small">â€¢ Trivy vulnerability scan</text>
  <text x="780" y="422" text-anchor="middle" class="small">â€¢ Check HIGH/CRITICAL</text>
  <text x="780" y="439" text-anchor="middle" class="small">â€¢ Generate report</text>
  <text x="780" y="456" text-anchor="middle" class="tiny">(trivy image scan)</text>

  <!-- Arrow down from Build stage to Registry -->
  <line x1="490" y1="470" x2="490" y2="530" stroke="#339af0" stroke-width="2.5" marker-end="url(#arrowhead)"/>
  <text x="510" y="505" class="small" fill="#339af0">image pushed</text>

  <!-- Container Registry -->
  <rect x="350" y="540" width="280" height="80" rx="8" fill="#ffffff" stroke="#339af0" stroke-width="2.5"/>
  <text x="490" y="570" text-anchor="middle" class="label">ğŸ³ Gitea Container Registry</text>
  <text x="490" y="590" text-anchor="middle" class="small">gitea:3000/remotelab/django-app:1.0.X</text>
  <text x="490" y="605" text-anchor="middle" class="tiny">Built-in Gitea package registry</text>

  <!-- Arrow to Image Updater (curved) -->
  <path d="M 630 580 Q 750 580 750 650" stroke="#7950f2" stroke-width="2.5" fill="none" marker-end="url(#arrowhead)"/>
  <text x="710" y="615" class="small" fill="#7950f2">polls for</text>
  <text x="710" y="630" class="small" fill="#7950f2">new tags</text>

  <!-- ArgoCD Image Updater -->
  <rect x="650" y="660" width="280" height="90" rx="8" fill="#ffffff" stroke="#7950f2" stroke-width="2.5"/>
  <text x="790" y="690" text-anchor="middle" class="label">ğŸ” ArgoCD Image Updater</text>
  <text x="790" y="710" text-anchor="middle" class="small">â€¢ Detects new image: 1.0.X</text>
  <text x="790" y="727" text-anchor="middle" class="small">â€¢ Matches semver pattern: 1.x</text>
  <text x="790" y="742" text-anchor="middle" class="tiny">Polls registry API every ~30s</text>

  <!-- Arrow from Image Updater to ArgoCD -->
  <line x1="650" y1="705" x2="490" y2="705" stroke="#7950f2" stroke-width="2.5" marker-end="url(#arrowhead)"/>
  <text x="565" y="695" class="small" fill="#7950f2">updates manifest</text>
  <text x="565" y="710" class="small" fill="#7950f2">via git commit</text>

  <!-- ArgoCD GitOps -->
  <rect x="350" y="660" width="280" height="90" rx="8" fill="#ffffff" stroke="#7950f2" stroke-width="2.5"/>
  <text x="490" y="690" text-anchor="middle" class="label">âš™ï¸ ArgoCD GitOps Engine</text>
  <text x="490" y="710" text-anchor="middle" class="small">â€¢ Manifest updated in Git</text>
  <text x="490" y="727" text-anchor="middle" class="small">â€¢ Detects configuration drift</text>
  <text x="490" y="742" text-anchor="middle" class="tiny">Auto-sync enabled</text>

  <!-- Arrow to Kubernetes -->
  <line x1="490" y1="750" x2="490" y2="800" stroke="#40c057" stroke-width="2.5" marker-end="url(#arrowhead)"/>
  <text x="520" y="780" class="small" fill="#40c057">kubectl apply</text>

  <!-- Kubernetes Deployment -->
  <rect x="50" y="810" width="900" height="120" rx="12" fill="#ebfbee" stroke="#40c057" stroke-width="2.5"/>
  <text x="70" y="840" class="label" fill="#2f9e44">â˜¸ï¸ Kubernetes Cluster (namespace: applications)</text>

  <!-- Old Pod -->
  <rect x="200" y="860" width="180" height="50" rx="8" fill="#f1f3f5" stroke="#868e96" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="290" y="880" text-anchor="middle" class="small" fill="#868e96">django-xxxxxxxxx-old</text>
  <text x="290" y="898" text-anchor="middle" class="tiny" fill="#868e96">image: ...django-app:1.0.5 (old)</text>

  <!-- Arrow showing rolling update -->
  <line x1="380" y1="885" x2="440" y2="885" stroke="#40c057" stroke-width="3" marker-end="url(#arrowhead-green)"/>
  <text x="410" y="875" class="small" fill="#40c057">rolling</text>
  <text x="410" y="890" class="small" fill="#40c057">update</text>

  <!-- New Pod -->
  <rect x="450" y="860" width="180" height="50" rx="8" fill="#ffffff" stroke="#40c057" stroke-width="2.5"/>
  <text x="540" y="880" text-anchor="middle" class="label" fill="#2f9e44">django-xxxxxxxxx-new</text>
  <text x="540" y="898" text-anchor="middle" class="small">image: ...django-app:1.0.6 âœ“</text>

  <!-- Linkerd sidecar note -->
  <rect x="650" y="860" width="230" height="50" rx="8" fill="#e7f5ff" stroke="#339af0" stroke-width="1.5"/>
  <text x="765" y="880" text-anchor="middle" class="small">ğŸ”’ Linkerd Sidecar</text>
  <text x="765" y="898" text-anchor="middle" class="tiny">Automatic mTLS encryption</text>

  <!-- Running Application -->
  <rect x="350" y="960" width="300" height="70" rx="8" fill="#ffffff" stroke="#40c057" stroke-width="2.5"/>
  <text x="500" y="990" text-anchor="middle" class="label" fill="#2f9e44">âœ… Running Application</text>
  <text x="500" y="1010" text-anchor="middle" class="small">https://localhost/django/api/</text>
  <text x="500" y="1025" text-anchor="middle" class="tiny">New version deployed successfully</text>

  <!-- Arrow to running app -->
  <line x1="540" y1="910" x2="540" y2="945" stroke="#40c057" stroke-width="2.5" marker-end="url(#arrowhead-green)"/>
  <line x1="540" y1="945" x2="500" y2="960" stroke="#40c057" stroke-width="2.5" marker-end="url(#arrowhead-green)"/>

  <!-- Timeline annotations -->
  <rect x="50" y="1050" width="900" height="35" rx="6" fill="#f8f9fa" stroke="#495057" stroke-width="1"/>
  <text x="70" y="1070" class="tiny">â±ï¸ Timeline: Push â†’ Test (30s) â†’ Build (60s) â†’ Scan (30s) â†’ Registry â†’ Detect (30s) â†’ Sync (10s) â†’ Deploy (30s)</text>
  <text x="70" y="1082" class="tiny" fill="#40c057">Total deployment time: ~3-5 minutes from code push to running application</text>

</svg>
